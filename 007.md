# PANEL 007 - CONSTRUCTOR DE TAREAS

> **Instrucción para iniciar:** Escribe `start 007.md` para ver este panel

---

## COMANDOS DISPONIBLES

| # | Comando | Descripcion |
|---|---------|-------------|
| **1** | Crear Nuevas Tareas | Escucho lo que necesitas y lo agrego al agente correcto |
| **2** | Agente Backend-API | `WORK/TAREAS_BACKEND-API.md` - Endpoints, modelos, base de datos |
| **3** | Agente Blockchain-Services | `WORK/TAREAS_BLOCKCHAIN-SERVICES.md` - TON, wallets, servicios externos |
| **4** | Agente Frontend-Admin | `WORK/TAREAS_FRONTEND-ADMIN.md` - Panel admin, admin.js, admin.css |
| **5** | Agente Frontend-User | `WORK/TAREAS_FRONTEND-USER.md` - App usuario, app.js, styles.css |

---

## INSTRUCCIONES POR COMANDO

### COMANDO 1: CREAR NUEVAS TAREAS

**Objetivo:** Entender PERFECTAMENTE lo que el usuario quiere antes de crear la tarea.

**Flujo Obligatorio:**

#### PASO 1: ESCUCHAR
El usuario describe lo que quiere (ej: "no me gusta esta seccion", "quiero agregar esto", "esto no funciona")

#### PASO 2: PREGUNTAR (OBLIGATORIO)
Antes de crear cualquier tarea, hacer TODAS las preguntas necesarias para entender:

**Preguntas de Contexto:**
- ¿Donde exactamente esta el problema? (URL, seccion, pantalla)
- ¿Que ves actualmente vs que esperabas ver?
- ¿Es un bug o una mejora/feature nueva?

**Preguntas de Alcance:**
- ¿Quieres que se elimine, modifique o agregue algo?
- ¿Hay algun diseno o referencia que quieras seguir?
- ¿Esto afecta solo a usuarios, solo a admin, o ambos?

**Preguntas de Prioridad:**
- ¿Que tan urgente es esto? (Critico/Alto/Medio/Bajo)
- ¿Hay algo que dependa de esto?

**Preguntas Tecnicas (si aplica):**
- ¿Hay datos que se deben guardar/mostrar?
- ¿Necesita conectarse con algun endpoint existente?
- ¿Hay validaciones especificas?

> **REGLA:** No hay limite de preguntas. Es mejor preguntar de mas que crear una tarea incompleta o mal entendida.

#### PASO 3: CONFIRMAR ENTENDIMIENTO
Antes de crear la tarea, resumir lo que entendi:
```
Entiendo que quieres:
- [Descripcion clara del cambio]
- Afecta a: [usuarios/admin/ambos]
- Prioridad: [nivel]
- Archivos involucrados: [lista]

¿Es correcto? ¿Falta algo?
```

#### PASO 4: ASIGNAR AGENTE
Analizar a que agente corresponde segun los archivos:
- Si toca `app.py`, `database.py`, `models.py` → Backend-API
- Si toca `wallet`, `b3c`, `encryption` → Blockchain-Services
- Si toca `admin.js`, `admin.css`, `admin.html` → Frontend-Admin
- Si toca `app.js`, `styles.css`, `index.html` → Frontend-User

> **IMPORTANTE:** Si la tarea requiere cambios en multiples agentes, dividirla en sub-tareas para cada uno.

#### PASO 5: CREAR LA TAREA
Agregar al archivo `.md` correcto con formato:
```markdown
### FASE XX.X: [NOMBRE DESCRIPTIVO] ⏳ [PRIORIDAD]
**Tiempo estimado:** Xh
**Fecha creacion:** [fecha]
**Solicitado por:** Usuario

**Contexto:**
[Descripcion del problema o necesidad]

**Tareas:**
- [ ] Tarea especifica 1
- [ ] Tarea especifica 2
- [ ] Tarea especifica 3

**Criterios de aceptacion:**
- [ ] [Que debe cumplirse para considerar la tarea terminada]
```

#### PASO 6: CONFIRMAR
Mostrar la tarea creada y a que agente fue asignada.

---

**Regla importante:** Los agentes NO pueden pisarse. Cada uno tiene sus propios archivos.

---

### COMANDOS 2-5: EJECUTAR AGENTE

**Flujo obligatorio:**

1. **Leer tareas pendientes** del archivo correspondiente
2. **Mostrar tareas pendientes** con prioridad
3. **REGLA OBLIGATORIA:** Decir al usuario que se conecte a la rama correcta:
   ```
   Por favor conectate a la rama: git checkout [rama]
   Dime "listo" cuando estes en la rama para comenzar.
   ```
4. **Esperar confirmacion** del usuario ("listo")
5. **Ejecutar tareas** una por una
6. **Al finalizar cada tarea**, dar comandos para subir:
   ```
   git add .
   git commit -m "[descripcion de la tarea]"
   git push origin [rama]
   ```

---

## ASIGNACION DE AGENTES

### AGENTE 2: Backend-API
**Rama:** `feature/backend-api`
**Archivos:**
- app.py
- tracking/database.py
- tracking/models.py
- tracking/email_service.py
- tracking/security.py
- tracking/telegram_service.py
- init_db.py
- seed_data.py
- requirements.txt

---

### AGENTE 3: Blockchain-Services
**Rama:** `feature/blockchain-services`
**Archivos:**
- tracking/b3c_service.py
- tracking/wallet_pool_service.py
- tracking/deposit_scheduler.py
- tracking/smspool_service.py
- tracking/cloudinary_service.py
- tracking/encryption.py

---

### AGENTE 4: Frontend-Admin
**Rama:** `feature/frontend-admin`
**Archivos:**
- static/js/admin.js
- static/css/admin.css
- templates/admin.html

---

### AGENTE 5: Frontend-User
**Rama:** `feature/frontend-user`
**Archivos:**
- static/js/app.js
- static/js/publications.js
- static/js/virtual-numbers.js
- static/js/utils.js
- static/css/styles.css
- templates/index.html
- templates/virtual_numbers.html

---

## RESUMEN RAPIDO DE TAREAS PENDIENTES

| Agente | Archivo | Tareas Pendientes | Horas Est. |
|--------|---------|-------------------|------------|
| Backend-API | WORK/TAREAS_BACKEND-API.md | 5 fases | ~17h |
| Blockchain | WORK/TAREAS_BLOCKCHAIN-SERVICES.md | 11 fases | ~48h |
| Frontend-Admin | WORK/TAREAS_FRONTEND-ADMIN.md | 18 fases | ~60h |
| Frontend-User | WORK/TAREAS_FRONTEND-USER.md | 12 fases | ~33h |

---

## COMO USAR

Escribe el numero del comando que quieres ejecutar:

- `1` - Para agregar nuevas tareas
- `2` - Para trabajar en Backend-API
- `3` - Para trabajar en Blockchain-Services
- `4` - Para trabajar en Frontend-Admin
- `5` - Para trabajar en Frontend-User

---

## REGLAS IMPORTANTES

1. **Antes de empezar cualquier agente (2-5):** Siempre pedir que se conecte a la rama
2. **No mezclar archivos:** Cada agente solo toca sus archivos asignados
3. **Al terminar cada tarea:** Dar comandos git para subir cambios
4. **Prioridades:** Seguir el orden recomendado en cada archivo de tareas
   - Rojo = Critico
   - Amarillo = Alta
   - Naranja = Media
   - Verde = Baja

---

# REGLAS DE CONSTRUCCION - CERO TOLERANCIA A FALLOS

## 1. ANTES DE COMENZAR CUALQUIER TAREA

- [ ] Leer el archivo completo que voy a modificar
- [ ] Entender el contexto y las dependencias
- [ ] Verificar que no hay errores previos en el codigo
- [ ] Identificar patrones existentes para seguirlos

---

## 2. DURANTE LA CONSTRUCCION

### Codigo Limpio:
- [ ] No dejar `console.log` en produccion (usar Logger)
- [ ] No dejar comentarios tipo `// TODO` o `// FIXME` sin resolver
- [ ] No dejar codigo comentado sin proposito
- [ ] Nombres de variables/funciones descriptivos en ingles
- [ ] Funciones pequenas y con un solo proposito

### Seguridad Obligatoria:
- [ ] Validar TODOS los inputs del usuario
- [ ] Escapar HTML para prevenir XSS (`html.escape()`)
- [ ] No exponer errores internos al usuario (usar `sanitize_error`)
- [ ] No hardcodear tokens, keys o secretos
- [ ] Usar parametros preparados en SQL (nunca concatenar strings)
- [ ] Verificar permisos antes de cada accion sensible
- [ ] Rate limiting en endpoints criticos

### Manejo de Errores:
- [ ] Try/catch en todas las operaciones async
- [ ] Mensajes de error claros para el usuario
- [ ] Logging de errores con contexto (request_id, user_id, ip)
- [ ] Retornar codigos HTTP correctos (400, 401, 403, 404, 500)

---

## 3. ANTES DE DAR POR TERMINADA UNA TAREA

### Verificaciones Obligatorias:
- [ ] El codigo compila/ejecuta sin errores
- [ ] No hay errores en los logs del servidor
- [ ] La funcionalidad hace lo que se pidio
- [ ] No se rompio nada existente
- [ ] Los endpoints retornan respuestas correctas

### Testing Manual:
- [ ] Probar el caso exitoso (happy path)
- [ ] Probar con datos invalidos
- [ ] Probar sin autenticacion (debe rechazar)
- [ ] Probar con usuario sin permisos (debe rechazar)

---

## 4. PROHIBICIONES ABSOLUTAS

| Prohibido | Razon |
|-----------|-------|
| Datos mock/placeholder en produccion | Confunde al usuario |
| `eval()` o `exec()` con input del usuario | Vulnerabilidad critica |
| SQL sin parametros preparados | SQL Injection |
| Mostrar stack traces al usuario | Fuga de informacion |
| Guardar passwords en texto plano | Vulnerabilidad critica |
| Ignorar errores con `except: pass` | Oculta problemas |
| Commits sin probar el codigo | Rompe la rama |

---

## 5. PATRON DE RESPUESTA API

Todas las respuestas deben seguir este formato:

**Exito:**
```json
{
  "success": true,
  "data": { ... }
}
```

**Error:**
```json
{
  "success": false,
  "error": "Mensaje amigable para el usuario"
}
```

---

## 6. CHECKLIST FINAL ANTES DEL COMMIT

```
[ ] El codigo funciona correctamente
[ ] No hay errores en consola/logs
[ ] Los inputs estan validados
[ ] Los errores estan manejados
[ ] No hay datos sensibles expuestos
[ ] El codigo sigue los patrones existentes
[ ] Reinicie el workflow y verifique que corre
```

---

## 7. SI ALGO FALLA

1. **NO AVANZAR** hasta que este resuelto
2. Leer el error completo
3. Buscar la causa raiz (no solo el sintoma)
4. Arreglar el problema
5. Verificar que no se rompio otra cosa
6. Solo entonces continuar

---

## 8. FLUJO DE TRABAJO SEGURO

```
LEER TAREA
    |
    v
LEER ARCHIVOS RELACIONADOS
    |
    v
IDENTIFICAR CAMBIOS NECESARIOS
    |
    v
IMPLEMENTAR (siguiendo patrones existentes)
    |
    v
VERIFICAR QUE FUNCIONA
    |
    v
VERIFICAR QUE NO ROMPIO NADA
    |
    v
REINICIAR WORKFLOW
    |
    v
VERIFICAR LOGS SIN ERRORES
    |
    v
DAR COMANDOS GIT
    |
    v
SIGUIENTE TAREA
```
